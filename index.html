<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Drug Glossary</title>
    <link rel="preload" href="data/data.json" as="fetch" crossorigin>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="container">
      <header class="site-header">
        <h1>Drug Glossary</h1>
        <label class="search">
          <input id="search" type="search" placeholder="Search drug..." autocomplete="off">
        </label>
      </header>

      <nav id="letters" class="letters" aria-label="Alphabetical index"></nav>

      <main class="layout">
        <section class="panel" aria-labelledby="drugs-title">
          <h2 id="drugs-title">Drugs</h2>
          <ul id="drugs" class="list"></ul>
        </section>
        <section class="panel" aria-labelledby="subdrugs-title">
          <h2 id="subdrugs-title">Subdrugs</h2>
          <ul id="subdrugs" class="list"></ul>
        </section>
        <section class="panel" aria-labelledby="details-title">
          <h2 id="details-title">Details</h2>
          <div id="details" class="details"></div>
          <button id="toTop" class="to-top" hidden>Return to Above</button>
        </section>
      </main>

      <footer class="site-footer">
      <a href="https://www.instagram.com/miftahulmuhaemen/" target="_blank" rel="noopener" style="color: #666;">@MiftahulMuhaemen on Instagram</a>
      </footer>
    </div>

    <script>
    (function() {
      'use strict';
      const byId = (id) => document.getElementById(id);
      const lettersNav = byId('letters');
      const drugsList = byId('drugs');
      const subdrugsList = byId('subdrugs');
      const detailsBox = byId('details');
      const searchInput = byId('search');

      /** @type {{data: Array<any>, letter: string|null, drug: any|null, subdrug: any|null, query: string}} */
      const state = { data: [], letter: null, drug: null, subdrug: null, query: '' };

      const A_CODE = 'A'.charCodeAt(0);
      const Z_CODE = 'Z'.charCodeAt(0);

      function create(tag, className, text) {
        const el = document.createElement(tag);
        if (className) el.className = className;
        if (text != null) el.textContent = text;
        return el;
      }

      function normalizeString(s) {
        return (s || '').toString().toLowerCase();
      }

      function renderLetters() {
        lettersNav.textContent = '';
        const allBtn = create('button', 'letter' + (state.letter === null ? ' active' : ''), 'All');
        allBtn.type = 'button';
        allBtn.addEventListener('click', () => { state.letter = null; state.drug = null; state.subdrug = null; renderAll(); });
        lettersNav.appendChild(allBtn);
        for (let c = A_CODE; c <= Z_CODE; c++) {
          const letter = String.fromCharCode(c);
          const btn = create('button', 'letter' + (state.letter === letter ? ' active' : ''), letter);
          btn.type = 'button';
          btn.addEventListener('click', () => { state.letter = letter; state.drug = null; state.subdrug = null; renderAll(); });
          lettersNav.appendChild(btn);
        }
      }

      function getFilteredDrugs() {
        const q = normalizeString(state.query);
        return state.data.filter(d => {
          const name = d && d.name ? d.name : '';
          const starts = state.letter ? normalizeString(name).startsWith(state.letter.toLowerCase()) : true;
          const matches = q ? normalizeString(name).includes(q) : true;
          return starts && matches;
        });
      }

      function renderDrugs() {
        drugsList.textContent = '';
        const drugs = getFilteredDrugs();
        drugs.forEach(drug => {
          const li = create('li');
          const btn = create('button', 'item', drug.name);
          btn.type = 'button';
          btn.addEventListener('click', () => { state.drug = drug; state.subdrug = null; renderSubdrugs(); renderDetails(); highlightSelected(drugsList, btn); scrollIntoViewTop('subdrugs-title'); revealTop(); });
          li.appendChild(btn);
          drugsList.appendChild(li);
        });
        if (!drugs.length) {
          const li = create('li', 'empty', 'No results');
          drugsList.appendChild(li);
        }
      }

      function renderSubdrugs() {
        subdrugsList.textContent = '';
        const subs = state.drug && Array.isArray(state.drug.subdrugs) ? state.drug.subdrugs : [];
        subs.forEach(sd => {
          const li = create('li');
          const btn = create('button', 'item', sd.name || '—');
          btn.type = 'button';
          btn.addEventListener('click', () => { state.subdrug = sd; renderDetails(); highlightSelected(subdrugsList, btn); scrollIntoViewTop('details-title'); revealTop(); });
          li.appendChild(btn);
          subdrugsList.appendChild(li);
        });
        if (!subs.length) {
          const li = create('li', 'empty', state.drug ? 'No subdrugs' : 'Select a drug');
          subdrugsList.appendChild(li);
        }
      }

      function asDisplayValue(v) {
        if (typeof v === 'boolean') return v;
        if (v === null || v === undefined) return '—';
        const s = String(v).trim();
        return s === '' ? '—' : s;
      }

      function renderDetails() {
        detailsBox.textContent = '';
        if (!state.subdrug) {
          detailsBox.appendChild(create('div', 'empty', state.drug ? 'Select a subdrug' : 'Select a drug'));
          return;
        }
        const title = create('h3', 'detail-title', state.subdrug.name || 'Details');
        detailsBox.appendChild(title);
        const table = create('table', 'kv');
        const tbody = create('tbody');
        table.appendChild(tbody);
        Object.keys(state.subdrug).forEach(key => {
          if (key === 'name') return;
          const raw = state.subdrug[key];
          const tr = create('tr');
          const tdK = create('td', 'k', key);
          const tdV = create('td', 'v');
          const dv = asDisplayValue(raw);
          if (typeof dv === 'boolean') {
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.disabled = true;
            cb.checked = dv;
            tdV.appendChild(cb);
          } else {
            tdV.textContent = dv;
          }
          tr.appendChild(tdK);
          tr.appendChild(tdV);
          tbody.appendChild(tr);
        });
        detailsBox.appendChild(table);
      }

      function highlightSelected(listEl, btn) {
        listEl.querySelectorAll('.item.selected').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
      }

      function scrollIntoViewTop(id) {
        const el = byId(id);
        if (!el) return;
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function renderAll() {
        renderLetters();
        renderDrugs();
        renderSubdrugs();
        renderDetails();
      }

      const toTopBtn = byId('toTop');
      function revealTop(){ toTopBtn.hidden = false; }
      toTopBtn.addEventListener('click', () => { window.scrollTo({ top: 0, behavior: 'smooth' }); });

      searchInput.addEventListener('input', () => {
        state.query = searchInput.value || '';
        state.drug = null;
        state.subdrug = null;
        renderDrugs();
        renderSubdrugs();
        renderDetails();
      });

      function load(url){ return fetch(url).then(r=>{ if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); }); }
      load('data/data.json').then(json=>{
        state.data = Array.isArray(json) ? json : [];
        renderAll();
      }).catch(()=>{
        lettersNav.textContent = '';
        drugsList.textContent = '';
        subdrugsList.textContent = '';
        detailsBox.textContent = 'Failed to load data.';
      });
    })();
    </script>
  </body>
  </html>


